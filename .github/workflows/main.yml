name: RDP Master - Generate & Scan

on:
  workflow_dispatch:
    inputs:
      country_code:
        description: 'كود الدولة (مثل: us, sa, eg)'
        required: true
        default: 'us'
      port:
        description: 'المنفذ (RDP Port)'
        required: true
        default: '3389'
      threads:
        description: 'عدد الخيوط للفحص (Threads)'
        required: true
        default: '1000'
      timeout:
        description: 'وقت المهلة (Timeout)'
        required: true
        default: '5'

jobs:
  ultra_process:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Environment (Python & Go)
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Install Python Dependencies
        run: pip install requests colorama ipaddress

      - name: Step 1: Generate CIDR Blocks (Python)
        run: |
          # التعديل هنا: نختار الخيار 1 لتوليد CIDR Blocks مباشرة
          # 3 (وضع الدولة) -> كود الدولة -> 1 (نظام البلوكات CIDR)
          printf "3\n${{ github.event.inputs.country_code }}\n1\n" | python main.py
          echo "✅ CIDR Blocks saved in IP.txt"

      - name: Step 2: Scan & Stream CIDR (Go)
        run: |
          # سكريبت Go الخاص بك ذكي؛ هو يقرأ IP.txt وإذا وجد / سيفعل دالة streamCIDR تلقائياً
          # يضغط Enter للموافقة على IP.txt -> المنفذ -> الثريدز -> التايم آوت
          printf "\n${{ github.event.inputs.port }}\n${{ github.event.inputs.threads }}\n${{ github.event.inputs.timeout }}\n" | go run main.go

      - name: Step 3: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: RDP-Scan-${{ github.event.inputs.country_code }}-${{ github.run_id }}
          path: |
            nla.txt
            nonla.txt
            error.txt
            timeout.txt
          if-no-files-found: warn
